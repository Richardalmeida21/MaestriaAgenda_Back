# ğŸ“‹ GUIA FRONTEND - CONTROLE DE DESCONTO DE TAXAS POR PROFISSIONAL

## ğŸ¯ NOVA FUNCIONALIDADE
O admin agora pode configurar **individualmente** se cada profissional tem desconto das taxas de pagamento ou nÃ£o.

---

## ğŸ”§ COMO O BACKEND FUNCIONA AGORA

### **Endpoint Novo - Alterar ConfiguraÃ§Ã£o:**
```
PATCH /profissional/{id}/desconto-taxas
```

**Request Body:**
```json
{
  "descontarTaxas": false
}
```

**Response:**
```json
{
  "id": 1,
  "nome": "JoÃ£o Silva", 
  "descontarTaxas": false,
  "mensagem": "âœ… ConfiguraÃ§Ã£o alterada: JoÃ£o Silva agora estÃ¡ SEM desconto de taxas"
}
```

### **Endpoint Existente - Listar Profissionais:**
```
GET /profissional
```

**Response (agora inclui descontarTaxas):**
```json
[
  {
    "id": 1,
    "nome": "JoÃ£o Silva",
    "login": "joao",
    "role": "PROFISSIONAL",
    "descontarTaxas": true
  },
  {
    "id": 2,
    "nome": "Maria Santos",
    "login": "maria", 
    "role": "PROFISSIONAL",
    "descontarTaxas": false
  }
]
```

### **Endpoint Existente - ComissÃµes:**
```
GET /financeiro/comissoes
```

**Response (valores jÃ¡ calculados automaticamente):**
```json
[
  {
    "profissionalId": 1,
    "nomeProfissional": "JoÃ£o Silva",
    "comissaoTotal": 70.00,      // Valor bruto
    "comissaoLiquida": 68.00,    // Valor final (COM desconto)
    "descontoTaxa": 2.00,
    "valorPendente": 68.00
  },
  {
    "profissionalId": 2,
    "nomeProfissional": "Maria Santos", 
    "comissaoTotal": 70.00,      // Valor bruto
    "comissaoLiquida": 70.00,    // Valor final (SEM desconto)
    "descontoTaxa": 2.00,        // Taxa calculada mas nÃ£o aplicada
    "valorPendente": 70.00
  }
]
```

---

## ğŸ¨ IMPLEMENTAÃ‡ÃƒO NO FRONTEND

### **1. Interface de ConfiguraÃ§Ã£o (Nova PÃ¡gina/Modal)**

#### **Estrutura da PÃ¡gina:**
```tsx
// ProfessionalTaxSettings.tsx
import React, { useState, useEffect } from 'react';

interface Professional {
  id: number;
  nome: string;
  descontarTaxas: boolean;
}

const ProfessionalTaxSettings = () => {
  const [professionals, setProfessionals] = useState<Professional[]>([]);
  const [loading, setLoading] = useState(false);

  // Carregar lista de profissionais
  useEffect(() => {
    loadProfessionals();
  }, []);

  const loadProfessionals = async () => {
    try {
      const response = await api.get('/profissional');
      setProfessionals(response.data);
    } catch (error) {
      console.error('Erro ao carregar profissionais:', error);
    }
  };

  // Alterar configuraÃ§Ã£o de desconto
  const toggleTaxDiscount = async (professionalId: number, newValue: boolean) => {
    setLoading(true);
    try {
      const response = await api.patch(`/profissional/${professionalId}/desconto-taxas`, {
        descontarTaxas: newValue
      });
      
      // Atualizar lista local
      setProfessionals(prev => 
        prev.map(prof => 
          prof.id === professionalId 
            ? { ...prof, descontarTaxas: newValue }
            : prof
        )
      );
      
      // Mostrar mensagem de sucesso
      toast.success(response.data.mensagem);
      
    } catch (error) {
      toast.error('Erro ao alterar configuraÃ§Ã£o');
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="tax-settings-container">
      <h2>âš™ï¸ ConfiguraÃ§Ãµes de Desconto de Taxas</h2>
      <p>Configure quem paga as taxas da maquininha de cartÃ£o</p>
      
      <div className="professionals-table">
        <table>
          <thead>
            <tr>
              <th>Profissional</th>
              <th>Desconto de Taxas</th>
              <th>Status</th>
              <th>AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody>
            {professionals.map(prof => (
              <tr key={prof.id}>
                <td>{prof.nome}</td>
                <td>
                  <Switch
                    checked={prof.descontarTaxas}
                    onChange={(checked) => toggleTaxDiscount(prof.id, checked)}
                    disabled={loading}
                  />
                </td>
                <td>
                  {prof.descontarTaxas ? (
                    <span className="status-with-discount">
                      ğŸ’¸ Paga taxas
                    </span>
                  ) : (
                    <span className="status-without-discount">
                      ğŸ’° NÃ£o paga taxas
                    </span>
                  )}
                </td>
                <td>
                  <button 
                    onClick={() => toggleTaxDiscount(prof.id, !prof.descontarTaxas)}
                    disabled={loading}
                  >
                    {prof.descontarTaxas ? 'Isentar' : 'Aplicar Desconto'}
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};
```

### **2. Atualizar ExibiÃ§Ã£o das ComissÃµes**

#### **Modificar Componente Existente:**
```tsx
// CommissionCard.tsx (componente existente)
const CommissionCard = ({ commission, professional }) => {
  return (
    <div className="commission-card">
      <div className="professional-header">
        <h3>{commission.nomeProfissional}</h3>
        
        {/* Indicador visual do tipo de desconto */}
        {professional?.descontarTaxas ? (
          <span className="tax-badge with-discount">
            ğŸ’¸ Com desconto de taxas
          </span>
        ) : (
          <span className="tax-badge without-discount">
            ğŸ’° Sem desconto de taxas
          </span>
        )}
      </div>

      <div className="commission-details">
        <div className="commission-line">
          <span>ComissÃ£o Bruta:</span>
          <span>R$ {commission.comissaoTotal.toFixed(2)}</span>
        </div>
        
        {/* Mostrar desconto de forma diferente baseado na configuraÃ§Ã£o */}
        <div className="commission-line">
          <span>Desconto Taxas:</span>
          {professional?.descontarTaxas ? (
            <span className="discount-applied">
              -R$ {commission.descontoTaxa.toFixed(2)}
            </span>
          ) : (
            <span className="discount-ignored">
              R$ 0,00 <small>(taxa: R$ {commission.descontoTaxa.toFixed(2)} - isento)</small>
            </span>
          )}
        </div>
        
        <div className="commission-line total">
          <span><strong>Valor a Pagar:</strong></span>
          <span><strong>R$ {commission.comissaoLiquida.toFixed(2)}</strong></span>
        </div>
      </div>
    </div>
  );
};
```

### **3. ServiÃ§o de API (Novo)**

```tsx
// services/professionalService.ts
export const professionalService = {
  // Listar profissionais com configuraÃ§Ã£o de desconto
  async list() {
    const response = await api.get('/profissional');
    return response.data;
  },

  // Alterar configuraÃ§Ã£o de desconto de taxas
  async updateTaxDiscount(professionalId: number, descontarTaxas: boolean) {
    const response = await api.patch(`/profissional/${professionalId}/desconto-taxas`, {
      descontarTaxas
    });
    return response.data;
  },

  // Buscar profissional especÃ­fico
  async getById(id: number) {
    const response = await api.get(`/profissional/${id}`);
    return response.data;
  }
};
```

---

## ğŸ¯ LOCALIZAÃ‡ÃƒO NO SISTEMA

### **Onde Adicionar a Nova Funcionalidade:**

#### **OpÃ§Ã£o 1: Menu Administrativo**
```
ğŸ“± Menu Admin
â”œâ”€â”€ ğŸ‘¥ Profissionais
â”‚   â”œâ”€â”€ â• Cadastrar Profissional
â”‚   â”œâ”€â”€ ğŸ“‹ Listar Profissionais  
â”‚   â””â”€â”€ âš™ï¸ Configurar Desconto de Taxas  â† NOVO
â”œâ”€â”€ ğŸ’° Financeiro
â””â”€â”€ ğŸ“Š RelatÃ³rios
```

#### **OpÃ§Ã£o 2: Dentro da PÃ¡gina de Profissionais**
```
ğŸ‘¥ PÃ¡gina de Profissionais
â”œâ”€â”€ ğŸ“‹ Lista de Profissionais
â”œâ”€â”€ â• BotÃ£o Novo Profissional
â””â”€â”€ âš™ï¸ Aba "ConfiguraÃ§Ãµes de Taxas"  â† NOVO
```

#### **OpÃ§Ã£o 3: Modal/Popup na Lista**
```
ğŸ‘¥ Lista de Profissionais
â”œâ”€â”€ JoÃ£o Silva    [Editar] [âš™ï¸ Configurar Taxas]  â† NOVO
â”œâ”€â”€ Maria Santos  [Editar] [âš™ï¸ Configurar Taxas]  â† NOVO
â””â”€â”€ Pedro Lima    [Editar] [âš™ï¸ Configurar Taxas]  â† NOVO
```

---

## ğŸ“± DESIGN SUGERIDO

### **Layout da ConfiguraÃ§Ã£o:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ ConfiguraÃ§Ãµes de Desconto de Taxas              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ Configure quem paga as taxas da maquininha      â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Profissional         â”‚ Desconto â”‚ Status       â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ ğŸ‘¤ JoÃ£o Silva       â”‚ [âœ… ON ]  â”‚ ğŸ’¸ Paga taxasâ”‚ â”‚
â”‚ â”‚ ğŸ‘¤ Maria Santos     â”‚ [âŒ OFF]  â”‚ ğŸ’° Isenta    â”‚ â”‚
â”‚ â”‚ ğŸ‘¤ Pedro Lima       â”‚ [âœ… ON ]  â”‚ ğŸ’¸ Paga taxasâ”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Indicadores nas ComissÃµes:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° JoÃ£o Silva                    ğŸ’¸ Com desconto   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ComissÃ£o Bruta:     R$ 70,00                       â”‚
â”‚ Desconto Taxas:     -R$ 2,00                       â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ A Pagar:            R$ 68,00                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° Maria Santos                  ğŸ’° Sem desconto   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ComissÃ£o Bruta:     R$ 70,00                       â”‚
â”‚ Desconto Taxas:     R$ 0,00 (isenta)               â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ A Pagar:            R$ 70,00                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ PONTOS IMPORTANTES

### **1. PermissÃµes:**
- âœ… **Apenas ADMIN** pode alterar configuraÃ§Ãµes
- âœ… **Todos** podem visualizar as configuraÃ§Ãµes

### **2. Estados do Sistema:**
- ğŸ”„ **Loading** durante alteraÃ§Ãµes
- âœ… **Feedback** visual ao alterar configuraÃ§Ã£o
- ğŸš¨ **Tratamento de erros** nas requisiÃ§Ãµes

### **3. Comportamento:**
- ğŸ“Š **Valores recalculados automaticamente** pelo backend
- ğŸ’¾ **ConfiguraÃ§Ã£o salva imediatamente** 
- ğŸ”„ **Interface atualizada em tempo real**

---

## ğŸš€ CHECKLIST DE IMPLEMENTAÃ‡ÃƒO

### **Backend (JÃ¡ Pronto):**
- âœ… MigraÃ§Ã£o da tabela executada
- âœ… Endpoint de configuraÃ§Ã£o funcionando
- âœ… LÃ³gica de cÃ¡lculo implementada

### **Frontend (A Fazer):**
- [ ] Criar componente de configuraÃ§Ã£o de taxas
- [ ] Adicionar indicadores visuais nas comissÃµes
- [ ] Implementar toggle/switch para alterar configuraÃ§Ã£o
- [ ] Adicionar feedback de sucesso/erro
- [ ] Testar permissÃµes (apenas admin)
- [ ] Validar cÃ¡lculos nas comissÃµes

---

## ğŸ“ DÃšVIDAS FREQUENTES

**Q: Como saber se um profissional tem desconto?**
**A:** Use o campo `descontarTaxas` na resposta de `/profissional`

**Q: Os valores mudam automaticamente?**
**A:** Sim! O backend recalcula automaticamente baseado na configuraÃ§Ã£o

**Q: Posso alterar vÃ¡rios profissionais de uma vez?**
**A:** NÃ£o no momento, apenas individualmente

**Q: O que acontece com comissÃµes antigas?**
**A:** Apenas cÃ¡lculos futuros sÃ£o afetados, histÃ³rico permanece igual

**ğŸ‰ Tudo pronto para implementar no frontend!**
